DELIMITER $$
CREATE PROCEDURE `SEARCH_ORDERS` (ORDERS_ID INT)
BEGIN
SELECT * 
FROM ORDERS O
WHERE O.ORDERSID = ORDERS_ID ;
END$$
-- CALL SEARCH_ORDERS(1);

DROP procedure IF EXISTS `ADD_ORDERS`;
DELIMITER $$
CREATE PROCEDURE `ADD_ORDERS` (ORDER_ID INT, CREATEAT DATETIME, STATE NVARCHAR(45), TOTAL INT, BILL_BILLID INT, SELLER_EMPID INT, CUSTOMER_CUSTOMERID INT)
BEGIN
INSERT INTO ORDERS VALUES (ORDER_ID, CREATEAT, STATE, TOTAL, BILL_BILLID, SELLER_EMPID, CUSTOMER_CUSTOMERID);
END$$
-- CALL ADD_ORDERS(5, '2021-04-30', 'US', 500000, 3, 2, 4);

DROP procedure IF EXISTS `SELECT_ORDERS`;
DELIMITER $$
CREATE PROCEDURE `SELECT_ORDERS` ()
BEGIN
SELECT * FROM ORDERS;
END$$
-- CALL SELECT_ORDERS;

DROP procedure IF EXISTS `UPDATE_ORDERS`;
DELIMITER $$
CREATE PROCEDURE `UPDATE_ORDERS` (ORDER_ID INT, NEW_TOTAL INT)
BEGIN
SET @B = (SELECT ORDERS.BILL_BILLID FROM ORDERS, BILL WHERE ORDERS.ORDERID = ORDER_ID AND BILL.BILLID = ORDERS.BILL_BILLID);
SET @A = (SELECT ORDERS.TOTAL FROM ORDERS, BILL WHERE ORDERS.ORDERID = ORDER_ID AND BILL.BILLID = ORDERS.BILL_BILLID);
UPDATE BILL SET TOTAL = NEW_TOTAL - @A + TOTAL WHERE BILLID = @B;
UPDATE ORDERS SET TOTAL = NEW_TOTAL WHERE ORDERID = ORDER_ID;
END$$
-- CALL UPDATE_ORDERS(1, 500000);

DELIMITER $$
CREATE PROCEDURE `DELETE_ORDERS` (ORDER_ID INT)
BEGIN
SET @B = (SELECT ORDERS.BILL_BILLID FROM ORDERS, BILL WHERE ORDERS.ORDERID = ORDER_ID AND BILL.BILLID = ORDERS.BILL_BILLID);
SET @A = (SELECT ORDERS.TOTAL FROM ORDERS, BILL WHERE ORDERS.ORDERID = ORDER_ID AND BILL.BILLID = ORDERS.BILL_BILLID);
UPDATE BILL SET TOTAL = TOTAL - @A WHERE BILLID = @B;
DELETE FROM PRODUCTORDER WHERE ORDERS_ORDERID = ORDER_ID; 
DELETE FROM ORDERS WHERE ORDERID = ORDER_ID;
END$$
-- CALL DELETE_ORDERS(1);